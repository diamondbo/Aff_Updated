@page "/"
@using FirstServ
@using Alpaca.Markets
@using System.Runtime.CompilerServices
@using System.Diagnostics.Eventing.Reader
@inject IAlpacaService Alserv

<PageTitle>Home</PageTitle>
<div class="center-header">
    <i class="bx bx-couch" style="font-size:64px;" />
       <h1>A F F</h1>
       <p>@buyingpower</p>
       <p>@cashh</p>
       <p>@bp2</p>

</div>
<div class="o_p_container">
<div id = "Posistions">
    @if (paper_Pos == null)
    {
        <p>No Positions </p>
    }
    else
    {
       <table>
        @foreach(var p in paper_Pos)
        {
            <tr>
                <th>@p.Symbol</th>
                <th>@p.Quantity</th>
                <th>@p.AssetCurrentPrice</th>
            </tr>
        }
       </table>
    }
    
</div>
<div class = "Orders">
    @if (l_orders != null)
    {
        <ul>
        @foreach(var or in l_orders)
        {
            <li>@or.Symbol</li>
        }
        </ul>
    }
</div>
</div>
@code {
    private decimal? buyingpower, cashh, bp2;
    private IEnumerable<IPosition>? paper_Pos;
    private List<IOrder>? l_orders;
    
    
    protected override async Task OnInitializedAsync()
    {
        var u_pos = await Alserv.GetPositions();
        if(u_pos != null)
        {
              paper_Pos = u_pos;
              
        }
        var u_opt = await Alserv.GetAllMyOrders();
        if (u_opt != null)
        {
            l_orders = u_opt.Take(5).ToList();
        }
        
    }
    protected async Task OnAfterRenderAsync()
    {
        var account = await Alserv.GetBuyingPower();
        var acce = await Alserv.GetCash();
        var d = await Alserv.GetAccount();
        bp2 = d.BuyingPower;
        buyingpower = account;
        cashh = acce;
    }
}